% Atom, description, circuit, SKETCH
\appendix
\section{Atom templates and circuit diagrams for atoms}
The appendix provides circuit diagrams (Figures~\ref{fig:rw}--~\ref{fig:pairs})
and templates (Table~\ref{tab:atom_code}) for the atoms in
Table~\ref{tab:templates}. Table~\ref{tab:sketch_constructs} summarizes the
notation we use in this section.
\begin{table}[!htbp]
  \begin{minipage}{\columnwidth}
  \begin{scriptsize}
  \begin{tabular}{p{0.3\columnwidth}p{0.7\columnwidth}}
  Construct & Description \\
  \hline
  MuxN(a1, a2, \dots, aN) & \pbox{0.7\columnwidth}{N-to-1 multiplexer with enable bit.\\If enabled, return one of a1, a2, \dots aN.\\If disabled, return 0.}\\
  Opt(a)        & Return a or 0. (Equivalent to Mux1(a)). \\
  rel\_op(x, y) & Return one of $x < y$, $x > y$, $x != y$, $x == y$.\\
  Const() & Return an integer constant in the range [0, 31].\footnote{We restrict constants to 5 bits because all constants within stateful codelets in our dataplane algorithms are under 32. Larger ranges increase synthesis time.} \\
  x, y & State variables \\
  pkt\_1, pkt\_2 & Packet fields \\
  \end{tabular}
  \end{scriptsize}
  \caption{Notation used in atom templates}
  \label{tab:sketch_constructs}
\end{minipage}
\end{table}
\input{sketch_table}

\newpage 
\begin{figure*}[!htbp]
  \center
  \includegraphics[width=\columnwidth]{rw.pdf}
  \caption{Circuit for Write atom with depth 1.}
  \label{fig:rw}
\end{figure*}
\begin{figure*}[!htbp]
  \center
  \includegraphics[width=\columnwidth]{raw.pdf}
  \caption{Circuit for RAW atom with depth 2.}
  \label{fig:raw}
\end{figure*}
\begin{figure*}[!htbp]
  \center
  \includegraphics[width=\columnwidth]{pred_raw.pdf}
  \caption{Circuit for PRAW atom with depth 3.}
  \label{fig:praw}
\end{figure*}
\newpage
\begin{figure*}[!htbp]
  \center
  \includegraphics[width=\columnwidth]{if_else.pdf}
  \caption{Circuit for IfElseRAW atom with depth 3.}
  \label{fig:ifelseraw}
\end{figure*}
\begin{figure*}[!htbp]
  \center
  \includegraphics[width=\columnwidth]{sub.pdf}
  \caption{Circuit for Sub atom with depth 4.}
  \label{fig:sub}
\end{figure*}

\newpage
\begin{figure*}[!htbp]
  \includegraphics[width=\textwidth]{nested.pdf}
  \caption{Circuit for Nested atom with depth 6.}
  \label{fig:nested}
\end{figure*}

\newpage
\begin{figure*}[!htbp]
  \includegraphics[width=0.95\textwidth]{pairs.pdf}
  \caption{One-half of the circuit for the Pairs atom with depth 6. The other
  half is identical, except that it updates y instead of x, and isn't shown for
simplicity. The shaded regions denote the differences in the Pairs atom
relative to the Nested atom: the predicates can depend on both x and y in the Pairs
atom.}
\label{fig:pairs}
\end{figure*}
